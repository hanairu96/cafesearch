<!DOCTYPE html>
<html xmlns:th="http://www.thymleaf.org">
<head>
  <th:block th:insert="~{/fragment/header::head}"></th:block>
</head>
<body>
  <div th:replace="~{/fragment/header::header}"></div>

  <img id="cafe-image" th:src="${detailCafe.image}">

  <div id="cafe-info" th:object="${detailCafe}">
    <p id="cafe-name" th:text="*{cafeName}"></p>
    <p id="cafe-star" th:text="'☆'+*{star}"></p>
    <p id="cafe-address" th:text="*{address}"></p>
  </div>
  <hr>
  <div id="map">
    <p>지도</p>
  </div>
  <hr>
  <div class="review-div">
    <div id="reivew-top">
      <p id="title-text" th:text="'리뷰('+${#lists.size(reviews)}+')'"></p>
      <p th:if="${not #strings.isEmpty(loginMember)}" id="review-post" th:onclick="reviewPost([[${detailCafe.cafeName}]]);">작성하기</p>
    </div>

    <div class="review-list">
      <div class="review" th:each="review: ${reviews}">
        <div id="review-left">
          <img id="profile-img" src="/image/icon-user.png">
          <p id="member-id" th:text="${review.memberId}"></p>
          <div id="review-change" th:if="${not #strings.isEmpty(loginMember)}">
            <input th:if="${review.memberId==loginMember.memberId}" type="button" value="수정" th:onclick="reviewUpdate([[${review.reviewNo}]]);">
            <input th:if="${review.memberId==loginMember.memberId}" type="button" value="삭제" th:onclick="reviewDelete([[${review.reviewNo}]]);">
          </div>
        </div>
        <div>
          <div id="review-text">
            <p id="review-title" th:text="${review.title}"></p>
            <p id="review-content" th:text="${review.content}"></p>
          </div>
          <div id="review-rest">
            <div id="review-star" th:text="'☆'+${review.star}"></div>
            <div id="review-date" th:text="${review.reviewDate}"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    #cafe-image{
      border: 1px solid black;
      height: 400px;
      width: 600px;
      margin: 0 auto;
      display: block;
      margin-top: 30px;
    }
    #cafe-info{
      height: 100px;
      width: 600px;
      margin: 0 auto;
      margin-top: 30px;
      margin-bottom: 30px;
    }
    #cafe-name{
      font-weight: bold;
      font-size: 20px;
    }

    #map{
      width: 600px;
      margin: 0 auto;
    }
    .review-div{
      width: 1100px;
      margin: 0 auto;
    }
    #reivew-top{
      display: flex;
    }
    #review-post{
      margin-left: 20px;
      cursor: pointer;
    }
    .review{
      display: flex;
      width: 1000px;
      margin: 0 auto;
      margin-top: 30px;
    }
    #profile-img{
      border: 1px solid black;
      border-radius: 50%;
      height: 100px;
      width: 100px;
      margin: 35px;
    }
    #member-id{
      text-align: center;
    }
    #review-change{
      display: flex;
      width: 80px;
      margin: 0 auto;
      padding: 10px 25px;
    }
    #review-change>*{
      margin-left: 5px;
      margin-right: 5px;
      cursor: pointer;
      width: 29px;
      border: 0px;
      background-color: white;
    }
    #review-text{
      border: 1px solid black;
      height: 220px;
      width: 700px;
      padding: 15px;
    }
    #review-title{
      font-weight: bold;
    }
    #review-rest{
      display: flex;
      margin-top: 10px;
    }
    #review-star{
      font-weight: bold;
      font-size: 30px;
    }
    #review-date{
      margin-left: 600px;
    }
  </style>

  <div th:replace="~{/fragment/footer::footer}"></div>
</body>
<script>
   let url = new URL(window.location.href); //현재 페이지 URL
   let urlParams = url.searchParams; //URL의 파라미터들
   let query = urlParams.get("query");
   let index = urlParams.get("index");

  const reviewPost = (cafeName)=>{
    location.assign("/cafe/reviewWrite?index="+index+"&query="+query+"&name="+cafeName);
  }

  const reviewUpdate = (reviewNo)=>{
    location.assign("/cafe/reviewUpdate?index="+index+"&query="+query+"&reviewNo="+reviewNo);
  }

  const reviewDelete = (reviewNo)=>{
    let check = confirm("정말로 삭제하시겠습니까?");
    if (check){
      $.ajax({
        url: "/cafe/review/"+reviewNo,
        type: "DELETE",
        success: data => {
          alert("삭제되었습니다.");
          location.reload();
        },
        error: e => {
          alert("삭제에 실패하였습니다.");
        }
      });
    }
  }

</script>
</html>